\chapter[Allgemeine Grundlagen]{Allgemeine Grundlagen}\label{sec:grundlagen}

\section[Mikroskopie]{Mikroskopie}\label{sec:mikroskopie}
Für die Pathologie und Hämatologie spielt das Lichtmikroskop eine entscheidende Rolle. Mit Hilfe der optischen Vergrößerung können Strukturen auf zellulärer Ebene sichtbar gemacht werden, was diagnostische Aussagen ermöglicht. Grundsätzlich besteht ein Lichtmikroskop aus Objektiv und Okular, wobei letzteres einer Lupe entspricht. Zunächst wird durch das Objektiv ein virtuelles Zwischenbild erzeugt, welches dann durch das Okular wiederum gedreht und auf die Kameraebene projiziert wird \citep[6f]{haus2014optische}. Der schematische Aufbau eines solchen Geräts ist in Abb. \ref{fig:strahlengang} gezeigt.
\begin{figure}
\center
\includegraphics[width = 0.7\textwidth]{pics/Grundlagen/Mikroskop_Strahlengang}
\caption[Schematischer Strahlengang Mikroskop]{Strahlengang im Mikroskop: Weg von Strahlen aus der Objektebene durch den Tubus und die Okularlinse in die Bildebene \cite{url_mikroskop_strahlengang}.\label{fig:strahlengang}}
\end{figure}
Die gesamte Vergrößerung $M_{ges}$ ergibt sich durch Multiplikation der Teilvergrößerungen der beiden Komponenten, wie in Formel \ref{equ:zoom} angegeben. $\beta_{Obj}$ entspricht dabei dem Abbildungsverhältnis des Objektiv, z.B. "40:1", und $M_{Ok}$.
\begin{equation}\label{equ:zoom}
M_{ges} = \beta_{Obj}M_{Ok}
\end{equation}

Das Präparat ist in der Regel zunächst nicht homogen ausgeleuchtet, wodurch eine spätere Analyse erschwert wird. Deshalb ist ein wichtiger Schritt beim Mikroskopieren das sogenannte Köhlern, wodurch Streulicht unterdrückt wird und die Beleuchtungsintensität auf ein relevantes Maß reduziert wird. Hierdurch können auch licht- und wärmeempfindliche Proben geschont werden \citep[19f]{haus2014optische}.    

\section[Knochenmarkdiagnostik]{}\label{sec:diagnostik}
\color{red}
Welche Informationen sind für den Arzt relevant. Wie würde ein nicht technisierter Ablauf aussehen
\color{black}
Das Knochenmark ist im menschlichen Körper ab dem 4.-5. Schwangerschaftsmonat zuständig für  für die Hämatopoese, also die Blutbildung. Zuvor übernehmen diese Aufgabe der Dottersack (bis zur 6. Woche) und Leber und Milz(ab Woche zwölf bis drei Wochen nach der Geburt). Bis zur Pubertät sind fast alle Knochen beteiligt, ab dem 30 Lebensjahr dagegen nur noch kurze und platte Knochen. Hierzu zählen Beckenschaufel, Wirbelkörper, Sternum, Rippen und der Schädel. Ist der Bedarf erhöht oder liegen knochenmarksverdrängende Prozesse vor, so können Milz, Leber und auch andere Organe für die Hämatopoese reaktiviert werden. Aus einer multipotenten Stammzelle entstehen über mehrere Zwischenstadien die verschiedenen Zellarten \ref{fig:haematopoese}.
\begin{figure}
\center
\includegraphics[width = 0.9\textwidth]{pics/Grundlagen/haematopoese}
\caption[Schema Hämatopoese]{Die Abbildung zeigt die Entwicklung einer Stammzelle über Zwischenstadien zur fertigen Zelle\cite{url_haematopoese}\label{fig:haematopoese}}
\end{figure}  

Die Gründe für eine zytologische Untersuchung des Knochenmarks sind vielfältig und reichen von außerhalb der Norm liegenden Differentialblutausstrichen bis zum Verdacht auf \leukaemie. Beim konventionellen Vorgehen wird zunächst mit einer Punktionsnadel eine geringe Menge an Knochenmark entnommen. Für die weitere Bearbeitung wird die Probe mit einer gerinnungshemmenden Lösung vermischt und auf einem Objektträger ausgestrichen. Im Anschluss muss die Schicht eine Stunde trocknen und wird dann mit dem Verfahren nach Pappenheim gefärbt. Diese Aufgabe übernimmt ein Automat, der dafür ca. 45 Minuten benötigt. Einer der Farbstoffe ist hierbei Methylenblau, welcher gelöst positive Ladung trägt und somit negativ geladene Zellbestandteile färbt. Beim anderen Farbstoff handelt es sich um Eosin, das mit seiner negativen Ladung vor allem positive Proteinstrukturen der Zelle färbt. 

Die Analyse der Probe findet unter einem Lichtmikroskop statt. Bei zehnfacher Vergrößerung kann dabei zunächst eine Aussage über Zelldichte und Fettgehalt getroffen werden. Teilweise gibt es auf dieser Stufe auch schon Informationen über qualitative Veränderungen, z.B. Häufung bestimmter Zelltypen. Geeignete Bereiche des Ausstrich werden anschließend bei stärkerer Vergrößerung (63x, seltener auch 100x) quantitativ ausgewertet. Dafür werden die verschiedenen Zelltypen gezählt, wobei mindestens 200 Zellen ausgewertet werden sollten, um Aussagen treffen zu können. Diese manuelle Auswertung dauert in der Regel zwischen 5 und 15 Minuten, in Einzelfällen sogar bis zu 30 Minuten. Das Ergebnis dieser Differentialzählung ist entscheidend für das weitere diagnostische und therapeutische Vorgehen. Hat ein Patient z.B. \leukaemie, so wird dieses Verfahren eine deutlich erhöhte Leukozytenzahl aufdecken, welche die restliche Blutbildung verdrängt.

\section[Segmentierung]{Segmentierung}\label{sec:segmentierung}
\color{red}
Hier rein oder in Methoden? Hat ja nichts mit der Farbnormalisierung an sich zu tun
\color{black}
Eine Automatisierung der Differenzialzählung erfordert zunächst eine stabile Segmentierung der einzelnen Zellen. \citeeig{krappe2015dynamic} stellen hierzu ein Verfahren vor, bei dem im ersten Schritt die Zellzentren detektiert werden sollen. Es wird ein Grauwertbild mit Hilfe eines gewichteten Quotienten von Grün- und Blaukanal generiert. Otsu-Thresholding führt im Anschluss zu einem Binärbild, in dem durch Zählen der schwarzen und weißen Pixel entschieden wird, ob das Bild viele oder wenige gefärbte Flächen enthält, wovon das weitere Vorgehen abhängt. Ist viel Vordergrund enthalten, so werden mit Hilfe morphologischer Operatoren Löcher im innerhalb weißer Flächen aufgefüllt. Für die Ermittlung potentieller Zellzentren, wird eine Wasserscheidentransformation auf dem gaußgefilterten oben beschriebenen Grauwertbild durchgeführt. Regionen welche eine Größe von 2500 Pixeln überschreiten, werden in eine Graphendarstellung umgewandelt. Falls gefundene Zentren eine euklidische Distanz von weniger als 70 Pixeln aufweisen, so wird davon ausgegangen, dass diese Knoten auf die gleiche Zelle verweisen, weshalb sie durch einen neuen Knoten ersetzt werden, der den Mittelwert repräsentiert. Dieser Schritt ist Abbildung \ref{fig:cell_centers} dargestellt.
\begin{figure}
\subfloat[Vor Korrektur: eine Zelle wird durch zwei Zentren beschrieben]{
\includegraphics[width=0.45\textwidth]
{pics/Grundlagen/centers_uncorrected}\label{fig:seg_uncorrected}}
\quad
\subfloat[Nach Korrektur: Jede Zelle mit nur einem Zentrum]{
\includegraphics[width=0.45\textwidth]
{pics/Grundlagen/centers_corrected}\label{fig:seg_corrected}}
\quad
\caption[Identifizierung Zellzentren]{Im Korrekturschritt werden Zentren mit geringer Distanz, grün markiert in $\mathbf{(a)}$, zu einem Zentrum zusammengefügt $mathbf{(b)}$. \label{fig:cell_centers}}
\end{figure} 
Hat das Bild dagegen einen hohen Vordergrundanteil, so wird eine Hintergrundkorrektur durchgeführt, bei der dieser durch ein 2D-Polynom dritten Grades approximiert wird. Der Vordergrund wird zunächst mit Hilfe eines Mittelwertfilters geschätzt und dann unter Verwendung des "Fast Marching"-Algorithmus konkretisiert. In der Folge werden homogene Regionen mit dem "Color Structure Code" extrahiert und als geordneter Graph dargestellt. Die Blätter dieses Graphen sind die potentiellen Zellzentren, die anhand des gleichen Verfahrens wie im Fall mit viel Vordergrund korrigiert werden. 
Um in der eigentlichen Segmentierung den äußeren Rand und die Grenze zwischen Zellkern und Zellplasma zu bestimmen, wird für jede Zelle eine Polartransformation mit dem im vorherigen Schritt gefundenen Zentrum durchgeführt. Es wird eine zu minimierende Kostenfunktion eingeführt, die aus sechs Komponenten besteht:
\begin{itemize}
\item{Gradient des gaussgefilterten Farbbild}
\item{Radius mit spezifischem minimalen und maximalem Radius \color{red} Komisches Bild, Wiederholung, Sebastian fragen,  BLABLA \color{black}}
\item{Gewichtung anhand Arcustangens von Blau- und Grünkanal}
\item{Unterschied zum vorher bestimmten Durchschnitt der Hintergrundpixel  \color{red} "Distance transform" = geht in Richtung invers?, Sebastian fragen,  BLABLA \color{black}}
\item{Unterschied zum vorher bestimmten Durchschnitt der Vordergrundpixel}
\item{SLIC Superpixel + Distanzmaß als Gewichtung}
\end{itemize}

Der Weg im Kostenbild von 0-6$\pi$ soll minimiert werden. Durch die dreifache Wiederholung wird verhindert, dass Anfang und Endpunkt des Weges nicht übereinstimmen. Dies hätte zur Folge, dass die Segmentierung im späteren Bild nicht geschlossen ist und einen Sprung aufweist. Die inverse Polartransformation überführt die segmentierende Linie zurück in den ursprünglichen Bildraum. Abbildung \ref{fig:seg_outer_borders} soll die einzelnen Schritte anhand eines Beispiels verdeutlichen.
\begin{figure}
\center
\subfloat[Originalbild]{
\includegraphics[width=0.35\textwidth]
{pics/Grundlagen/seg_orig}\label{fig:seg_original}}
\quad
\subfloat[Polartransformiertes Original, dreifach aneinandergehängt]{
\includegraphics[width = 0.9\textwidth]{pics/Grundlagen/seg_polar}\label{fig:seg_polartransform}}
\quad
\subfloat[Kostenfunktion]{
\includegraphics[width = 0.9\textwidth]{pics/Grundlagen/seg_function}\label{fig:seg_costfunction}}
\quad
\subfloat[Weg mit minimalen Kosten]{
\includegraphics[width = 0.9\textwidth]{pics/Grundlagen/seg_min}\label{fig:seg_min}}
\quad
\subfloat[Hervorgehobenes Ergebnis Segmentierung]{
\includegraphics[width=0.35\textwidth]
{pics/Grundlagen/seg_seg}\label{fig:seg_seg}}
\quad
\caption[Segmentierung mittels Polartransformation]{$\mathbf{(a)}$ Originalbild; $\mathbf{(b)}$ Polartransformation mit Zentrum der Zelle als Nullpunkt; $\mathbf{(c)}$ Kostenfunktion, wobei die Kosten in den dunklen Bereichen minimal sind; $\mathbf{(d)}$ Auswertung der Kostenfunktion: Grüne Linie entspricht Weg mit den geringsten Kosten; $\mathbf{(e)}$ Inverse Polartransformation, heller Bereich entspricht der segmentierten Zelle \label{fig:seg_outer_borders}}
\end{figure}
Die Unterscheidung zwischen Plasma und Zellkern wird wieder auf dem Graubild realisiert, welches durch den Arcustangens von Blau und Grün gebildet wird. Dafür wird das Histogramm der Pixel, die innerhalb der zuvor segmentierten Zelle liegen, bestimmt. Mit Hilfe der Grenzwertbestimmung von Otsu wird das Histogramm und dadurch auch das Bild in zwei verschiedene Bereiche aufgeteilt.
  
\section[Klassifizierung]{Klassifizierung}\label{sec:klassifizierung}
\color{red}
Hier rein oder Methoden? Hat ja nichts mit der Farbnormalisierung an sich zu tun? Paper fehlt noch in Quellen!! Veröffentlichung abwarten?
\color{black}
Der zweite wichtige Baustein für eine automatisierte Differentialzählung ist die Zellklassifikation, welche der Segmentierung nachfolgt. In diesem Schritt soll die Zelle einer von 16 Klassen zugeordnet werden. Hierbei soll das Wissen über die Hematopoese genutzt werden und in Form eines hierarchischen Baummodell nachgebildet werden, wie in Abbildung \ref{fig:classification_tree} dargestellt.
\begin{figure}
\center
\includegraphics[width = 0.95\textwidth]{pics/Grundlagen/classificationtree}
\caption[Hierarchisches Baummodell für die Klassifikation]{Darstellung des hierarchischen Baummodell, das die Hematopoese annähert\label{fig:classification_tree}}
\end{figure} 
Die für die Klassifikation verwendeten Merkmale teilen sich in Form, Textur und Farbe auf. Bei der Form spielen die gesamte Fläche, das Verhältnis aus Kern und Plasma, Konturmerkmale, Zernike Momente, normalisierte zentrale Momente, normalisierte Merkmale des Radius, Formfaktoren und Anzahl der Kernsegmente. Die Textur wird durch "local binary patterns", Grauwertmatrizen, Merkmale basierend auf Summen- und Differenzhistogrammen, farbbasierte Texturmerkmale, Charakterisierung von Heterogenität und Granularität...\color{red} BLALBLA, Sebastian fragen wegen deutscher Begriffe für die einzelnen Features \color{black}. 



