\chapter[Diskussion]{Diskussion}\label{sec:diskussion}
Im Folgenden werden die Ergebnisse aus Kapitel \ref{sec:ergebnis} diskutiert und bewertet. Dabei wird zunächst allgemein auf die Ansätze zur Farbnormalisierung eingegangen, im Anschluss werden die beiden Bereiche Segmentierung und Klassifikation behandelt. 

\section{Allgemein}\label{sec:dis_allgemein}
Beim Vergleich des Farbeindrucks für die verschiedenen getesteten Methoden wird offensichtlich, dass Farbinformationen unterschiedlich stark verfälscht werden. Dies soll in Abbildung \ref{fig:farbvergleich_norm} anhand von drei Beispielen gezeigt werden. Am deutlichsten ist die Veränderung bei Reinhard und bei der Anpassung von Mittelwert und Standardabweichung, welche sich nur im geänderten Farbraum unterscheiden. Als Zielbild diente dabei jeweils Referenzbild 1 (siehe Anhang \ref{app:reference}). Das Ergebnis ist dabei besonders stark durch den Anteil an gefärbten Bereichen beeinflusst, was ein großer Nachteil der Verfahren ist. Weniger unnatürlich wirken die Bilder nach Normalisierung mittels B-Spline und auf ein festgelegtes Pseudomaximum. Letztere Variante ähnelt im Hintergrund stark dem Original, da der dritte Kanal nicht angepasst wurde. Die gefärbten Teile wirken insgesamt dunkler als beim Original, da das Maximum jeweils erhöht wurde. Die mittels B-Splines angepassten Bilder normalisieren den Hintergrund sehr gut, so dass dieser sich in den verschiedenen Bildern stark ähnelt. Bei den gefärbten Bereichen ändert sich in Plasmabereichen teilweise das Verhältnis der beiden Farbstoffe. Zu sehen ist dieser Effekt beim Vergleich der Abbildungen \ref{fig:orig2} und \ref{fig:spline_giemsa2}. Bei der Zelle im Zentrum ist das Plasma nach der Anpassung leicht violett, während es zuvor bläulich erscheint. Die Referenz für beide Fälle ist Set 5 (siehe Anhang \ref{app:reference}), da hier die besten Ergebnisse für Segmentierung und Klassifikation erreicht werden. 

\newcommand{\mywidth}{0.13}
\begin{figure}[htb]
\center
\subfloat[Original 1]{
\includegraphics[width = \mywidth\textwidth]{pics/Anhang/B/02_or}}
\quad
\subfloat[B-Spline Giemsa 1]{
\includegraphics[width = \mywidth\textwidth]{pics/Anhang/B/02_gie}}
\quad
\subfloat[B-Spline Macenko 1]{
\includegraphics[width = \mywidth\textwidth]{pics/Anhang/B/02_mac}}
\quad
\subfloat[Festes Maximum 1]{
\includegraphics[width = \mywidth\textwidth]{pics/Anhang/B/02_fix}}
\quad
\subfloat[Mean/Std 1]{
\includegraphics[width = \mywidth\textwidth]{pics/Anhang/B/02_std}}
\quad
\subfloat[Reinhard 1]{
\includegraphics[width = \mywidth\textwidth]{pics/Anhang/B/02_rei}}
\quad
\subfloat[Original 2]{
\includegraphics[width = \mywidth\textwidth]{pics/Anhang/B/03_or}\label{fig:orig2}}
\quad
\subfloat[B-Spline Giemsa 2]{
\includegraphics[width = \mywidth\textwidth]{pics/Anhang/B/03_gie}\label{fig:spline_giemsa2}}
\quad
\subfloat[B-Spline Macenko 2]{
\includegraphics[width = \mywidth\textwidth]{pics/Anhang/B/03_mac}}
\quad
\subfloat[Festes Maximum 2]{
\includegraphics[width = \mywidth\textwidth]{pics/Anhang/B/03_fix}}
\quad
\subfloat[Mean/Std 2]{
\includegraphics[width = \mywidth\textwidth]{pics/Anhang/B/03_std}}
\quad
\subfloat[Reinhard 2]{
\includegraphics[width = \mywidth\textwidth]{pics/Anhang/B/03_rei}}
\quad
\subfloat[Original 3]{
\includegraphics[width = \mywidth\textwidth]{pics/Anhang/B/13_or}}
\quad
\subfloat[B-Spline Giemsa 3]{
\includegraphics[width = \mywidth\textwidth]{pics/Anhang/B/13_gie}}
\quad
\subfloat[B-Spline Macenko 3]{
\includegraphics[width = \mywidth\textwidth]{pics/Anhang/B/13_mac}}
\quad
\subfloat[Festes Maximum 3]{
\includegraphics[width = \mywidth\textwidth]{pics/Anhang/B/13_fix}}
\quad
\subfloat[Mean/Std 3]{
\includegraphics[width = \mywidth\textwidth]{pics/Anhang/B/13_std}}
\quad
\subfloat[Reinhard 3]{
\includegraphics[width = \mywidth\textwidth]{pics/Anhang/B/13_rei}}
\caption[Vergleich Ausgabebilder unterschiedlicher Methoden]{Die Abbildung zeigt drei Beispiele, wie sich die Normalisierung durch verschiedene Methoden auf Originalbilder auswirkt.\label{fig:farbvergleich_norm} }
\end{figure}

Der Grund für die größte Stabilität der Anpassung mittels B-Splines liegt in der Berücksichtigung der verschiedenartigen Bereiche im Bild. Prinzipiell wäre dies auch für die anderen Methoden möglich, jedoch müssten hierfür die äquivalenten Regionen separat aneinander angepasst werden. Für das vorliegende Problem ist dies jedoch nicht möglich, da die dadurch entstehenden Kanten, das Ergebnis des Segmentierungsalgorithmus vorweg nehmen würden. Bei der Anpassung durch einen B-Spline mit hohem Grad werden Kanten nicht unnatürlich verändert, da der B-Spline in hohem Maße stetig ist. Dadurch haben sich ähnelnde Pixel auch nach der Anpassung ähnliche Werte. Wird dagegen ein niedriger Grad gewählt, so haben eventuelle Ausreißer ein starkes Gewicht. Im schlimmsten Fall kann dies dazu führen, dass der B-Spline nicht mehr monoton steigt. Ein Pixel der zuvor einen höheren Wert hatte als ein anderer, könnte nach der Normalisierung eine niedrigere Intensität aufweisen. Da sich Eingangsbild und Referenz stark unterscheiden können, was zu Ausreißern bei den Kontrollpunkten führt, muss ein hoher Grad gewählt werden um die Stabilität der Ergebnisse zu gewährleisten. 
 
\section{Segmentierung}\label{sec:dis_seg}
Bei Betrachtung der Ergebnisse der Segmentierung ist festzustellen, dass die Normalisierung für die meisten Zellen keinen Unterschied macht. Liegen beispielsweise mehrere Zellen dicht aufeinander, so dass keine deutliche Grenze mehr erkennbar ist, kann dieser Effekt durch die Anpassung nicht korrigiert werden. Sind dagegen alle Bereiche gut voneinander separierbar, so ist dies ebenfalls unabhängig von der Normalisierung und die automatische Segmentierung funktioniert für alle Fälle. Interessant sind die Fälle in der eine klare Verbesserung oder Verschlechterung vorliegt. Die Resultate legen nahe, dass eine positive Veränderung deutlich häufiger ist als eine negative. Für die Anpassung mittels B-Splines und auch beim festen Maximum gilt, dass die Farben dazu tendieren dunkler zu werden. Zwar wird auch der Hintergrund etwas dunkler, jedoch wird eine leichte Färbung eliminiert, welche sich nachteilig auf die Segmentierung auswirken kann. Für eine gute Trennung zwischen Plasma und Kern ist es optimal, wenn beide Regionen möglichst homogen sind und sich gleichzeitig voneinander abgrenzen lassen. Werden als Referenz Bilder gewählt, bei denen der gefärbte Bereich diese Eigenschaften erfüllt, so können diese auch auf die anzupassenden Bilder übertragen werden. Die Resultate in Kapitel \ref{sec:res_bspline_params} zeigen deutlich, dass nicht jedes Bild als Referenz geeignet ist, obwohl die automatische Segmentierung dort gut funktioniert. Es könnte z.B. sein, dass sich eine andere Zelle im Bild negativ auswirkt, oder störende Artefakte enthalten sind. In der vorliegenden Arbeit konnte eine Optimierung der Ergebnisse durch die Entfernung schwacher Einzelbilder aus dem Referenzset erzielt werden. Ein gewisse Vielfalt ist dennoch notwendig um die Eigenschaften möglichst vieler Zellen abzubilden. Mit Set 6, welches nur drei Zellen enthält (siehe Anhang \ref{app:reference}), wurden die Ergebnisse wieder leicht schlechter. 
Wie zu erwarten war, erzielte auch die Skalierung auf ein festes Maximum bezüglich der Segmentierung gute Ergebnisse. Dies lässt sich durch die Erhöhung des Kontrastes bei der Wahl eines verhältnismäßig hohen Maximums begründen. Eine Homogenisierung innerhalb Zellkern bzw. Plasma ist indes durch eine reine Skalierung nicht zu erreichen, was der Grund dafür sein könnte, dass B-Splines für die Kernsegmentierung etwas besser funktionieren. 
Die Art einer Zelle ist von entscheidender Bedeutung für die automatische Segmentierung, sowie die Veränderung, welche mit einer möglichen Anpassung einhergeht. Bei Normoblasten ist beispielsweise das Plasma relativ hell, was sie allgemein zu schwierigen Fällen für das Erkennen der ganzen Zelle macht. Nach der Farbnormalisierung wird dieses Ergebnis durchschnittlich sogar noch etwas schlechter, da im Clustering das Plasma häufig keiner Klasse zugeordnet werden kann. Dies hat zur Folge, dass sich stattdessen der Kontrast im Zellkern erhöht. Daneben wird das Plasma noch heller und kann der Zelle nicht mehr zugeordnet werden. Durch den sehr dunklen Kern entspricht auch die Skalierung auf ein relativ hohes Pseudomaximum trotzdem einer Stauchung, wodurch das Plasma ebenfalls nochmals heller wird. Wird die ganze Zelle schon im Clustering-Schritt als gefärbt erkannt, so besteht eine gute Chance, dass sich sowohl Zellkern als auch Plasma gut voneinander und vom Hintergrund absetzen. Gerade die Segmentierung des Zellkerns kann durch die angewandten Normalisierungsverfahren im Mittel verbessert werden. 

\section{Klassifikation}\label{sec:dis_klass}

Für die Klassifikation wurde eine verhältnismäßig kleine, jedoch repräsentative Datenbank von 1000 Trainings- und 100 Testbildern eingesetzt. Dies hat zur Folge, dass die Ergebnisse nicht mit jenen verglichen werden können die \citeeig{krappe2016automated} erzielt haben, da dort mit über 140000 Zellen gearbeitet wurde. Aufgrund der geringen Zahl an Bildern in dieser Arbeit können hier nur Trends abgeleitet werden, die noch bestätigt werden müssen. Eine valide Aussage ist jedoch, dass die Qualität der Klassifikation mit besserer Segmentierung steigt. Dieser Zusammenhang ist in Abbildung \ref{fig:seg_vs_class} dargestellt, in der die Segmentierung bezüglich Zellkern mit der Trefferquote und der Genauigkeit der Experimente in Verbindung gebracht ist. Eine verbesserte Trefferquote geht nicht zu Lasten der Genauigkeit, da beide Trendlinien ansteigen. Bei den beiden Maßen für die Klassifikation sind  jeweils die Toleranzfelder berücksichtigt. Das Experiment mit der Handsegmentierung ist nicht mit einbezogen, da eine perfekte Segmentierung mit Wert 1.0 das Bild zu sehr beeinflussen und die restlichen Werte überlagern würde. 

\begin{figure}
\center
\subfloat[Trefferquote]{
\includegraphics[width = 0.8\textwidth]{pics/Diskussion/seg_vs_class}}
\quad
\subfloat[Genauigkeit]{
\includegraphics[width = 0.8\textwidth]{pics/Diskussion/seg_vs_class_precision}}
\caption[Klassifikation in Abhängigkeit von der Segmentierung]{Abbildung \textbf{(a)} zeigt die Trefferwahrscheinlichkeit der Klassifikationsexperimente in Abhängigkeit von der Qualität der verwendeten Segmentierung. \textbf{(b)} äquivalent dazu die Genauigkeit in Abhängigkeit der Segmentierung. In blau sind dabei die Datenpunkte zu sehen, von denen jeder für ein Experiment steht. In schwarz ist jeweils die zugehörige lineare Trendlinie zu sehen.\label{fig:seg_vs_class}}
\end{figure}

Der Einfluss der Veränderung der Farbeeigenschaften der Zelle, kann nicht eindeutig bewertet werden. Die Experimente 1 und 10, in denen die gleiche automatische Segmentierung mit normalisierten bzw. originalen Bildern getestet wurde, lieferten vor allem unter Berücksichtigung der Toleranzfelder sehr ähnliche Resultate. Die Befürchtung, dass eine Anpassung aller verschiedenen Zellarten auf die gleichen Farbeigenschaften sich nachteilig auf die Klassifikationsfähigkeit auswirken könnte hat sich jedoch nicht bestätigt. Falls ein Trend in den vorliegenden Experimenten vorhanden ist, so ist er durch den Einfluss der Segmentierung überlagert.  
